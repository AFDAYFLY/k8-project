<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìì†Œì„œ í‚¤ì›Œë“œ ë¶„ì„ê¸° Pro | AI ì§€ëŠ¥í˜• êµì •</title>
    <style>
        /* [ë””ìì¸ ì‹œìŠ¤í…œ] ì‹œì¸ì„±ê³¼ ì „ë¬¸ì„±ì„ ê°•ì¡°í•œ í´ë¦° UI */
        :root { --primary-blue: #0056b3; --accent-blue: #e7f1ff; --text-dark: #333; --bg-light: #f4f7f9; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg-light); color: var(--text-dark); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 40px auto; background: #fff; padding: 50px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-size: 2.2rem; color: var(--primary-blue); font-weight: 800; }

        /* ì…ë ¥ ë° ê²°ê³¼ ì˜ì—­ */
        textarea { width: 100%; height: 350px; padding: 25px; border-radius: 16px; border: 2px solid #e1e4e8; font-size: 1.1rem; line-height: 1.8; outline: none; transition: 0.3s; box-sizing: border-box; resize: none; }
        textarea:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 4px var(--accent-blue); }

        /* ì•Œë¦¼ì°½ ìŠ¤íƒ€ì¼ */
        #typoAlertArea { background: #fff4e5; border: 1px solid #ffe0b2; padding: 20px; border-radius: 16px; margin: 20px 0; display: none; }
        #aiResultArea { display: none; margin-top: 30px; border: 2px solid var(--primary-blue); border-radius: 16px; background: #fff; overflow: hidden; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { padding: 15px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; border: none; transition: 0.2s; }
        .btn-primary { background: var(--primary-blue); color: #fff; flex: 2; }
        .btn-ai { background: #1a1a1a; color: #4ade80; flex: 3; }
        .btn-secondary { background: #eee; color: #333; flex: 1; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* í†µê³„ ë° ë¦¬í¬íŠ¸ */
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0; }
        .stat-box { background: #fff; padding: 20px; border-radius: 16px; text-align: center; border: 1px solid #eee; }
        .stat-box strong { font-size: 1.5rem; color: var(--primary-blue); }

    /* ë¶„ì„ ê²Œì´ì§€ ë°” ì „ì²´ ì»¨í…Œì´ë„ˆ */
.score-container {
    width: 100%;
    background-color: #eee;
    border-radius: 10px;
    height: 12px;
    margin-top: 8px;
    overflow: hidden; /* ìì‹ ìš”ì†Œê°€ ì‚ì ¸ë‚˜ê°€ì§€ ì•Šê²Œ ì„¤ì • */
}

/* ì‹¤ì œ ì ìˆ˜ê°€ í‘œì‹œë˜ëŠ” íŒŒë€ìƒ‰ ë°” */
.score-fill {
    height: 100%;
    background: linear-gradient(90deg, #0056b3, #00c6ff); /* ì„¸ë ¨ëœ ë¸”ë£¨ ê·¸ë¼ë°ì´ì…˜ */
    width: 0%; /* ì²˜ìŒì—ëŠ” 0%ì˜€ë‹¤ê°€ JSë¡œ ì¡°ì ˆ */
    transition: width 1.5s ease-out; /* ì ìˆ˜ê°€ ìŠ¤ë¥´ë¥´ ì°¨ì˜¤ë¥´ëŠ” íš¨ê³¼ */
    border-radius: 10px;
}

/* ì ìˆ˜ ìˆ«ì í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.score-number {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--primary-blue);
}
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ìì†Œì„œ í‚¤ì›Œë“œ ë¶„ì„ê¸° Pro</h1>
        <p>ì‹¤ì‹œê°„ ë¶„ì„ë¶€í„° AI ë¬¸ì¥ êµì •ê¹Œì§€ í•œ ë²ˆì— ëë‚´ì„¸ìš”.</p>
    </header>

    <main>
        <textarea id="essayInput" placeholder="ìê¸°ì†Œê°œì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." oninput="analyze()"></textarea>

        <div id="typoAlertArea">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="margin:0; color:#b45309;">âš ï¸ ì˜¤íƒ€ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</h3>
                <button onclick="fixAllTypos()" style="padding:8px 15px; background:#ef4444; color:#fff; border:none; border-radius:8px; cursor:pointer;">ì¦‰ì‹œ ìˆ˜ì •</button>
            </div>
            <ul id="typoList" style="margin:0; color:#b45309;"></ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-ai" onclick="callGeminiAPI()" id="btnAi">âœ¨ AI ì§€ëŠ¥í˜• ë¬¸ì¥ êµì •</button>
            <button class="btn btn-secondary" onclick="resetAll()">ì´ˆê¸°í™”</button>
        </div>

        <div class="dashboard">
            <div class="stat-box"><span>ê³µë°± í¬í•¨</span><br><strong id="withSpace">0</strong>ì</div>
            <div class="stat-box"><span>ê³µë°± ì œì™¸</span><br><strong id="noSpace">0</strong>ì</div>
            <div class="stat-box"><span>ë‹¨ì–´ ìˆ˜</span><br><strong id="wordCount">0</strong>ê°œ</div>
        </div>

       <div id="aiResultArea" style="display: none; margin-top: 30px; border: 2px solid var(--primary-blue); border-radius: 16px; background: #fff; overflow: hidden;">
    <div style="background: var(--primary-blue); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between;">
        <span>ğŸ¤– AI ì§€ëŠ¥í˜• ì—­ëŸ‰ ë¶„ì„ ë¦¬í¬íŠ¸</span>
        <span id="aiLoading" style="display: none;">ë¶„ì„ ì¤‘... â³</span>
    </div>
    
    <div style="text-align:center;">
    <span>ğŸ¯ ì§ë¬´ ì í•©ì„±</span><br>
    <span id="score1_val" class="score-number">0</span><span class="score-number">ì </span>
    <div class="score-container"><div id="score1_bar" class="score-fill"></div></div>
</div>
<div style="text-align:center;">
    <span>ğŸ“ ë¬¸ì¥ ë…¼ë¦¬ì„±</span><br>
    <span id="score2_val" class="score-number">0</span><span class="score-number">ì </span>
    <div class="score-container"><div id="score2_bar" class="score-fill"></div></div>
</div>
<div style="text-align:center;">
    <span>ğŸ‘€ ì½ê¸° í¸ì˜ì„±</span><br>
    <span id="score3_val" class="score-number">0</span><span class="score-number">ì </span>
    <div class="score-container"><div id="score3_bar" class="score-fill"></div></div>
</div>

    <div id="aiContent" style="padding: 25px; line-height: 1.8; font-size: 1.05rem; white-space: pre-wrap;">
        ë¶„ì„ì„ ì‹œì‘í•˜ë©´ ì´ê³³ì— ìƒì„¸ ë¦¬í¬íŠ¸ê°€ ì‘ì„±ë©ë‹ˆë‹¤.
    </div>
    
    <div style="display:flex; gap:1px; background:#eee;">
        <button onclick="copyToClipboard()" style="flex:1; padding:15px; border:none; background:#fff; cursor:pointer; font-weight:bold;">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
        <button onclick="saveAsTxt()" style="flex:1; padding:15px; border:none; background:#fff; cursor:pointer; font-weight:bold;">ğŸ’¾ ë¦¬í¬íŠ¸ ì €ì¥</button>
    </div>
</div>
    </main>
</div>

<script>
    // 1. ì„¤ì •: ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”.
const API_KEY = "AIzaSyBzjYmtAb-qxGIHqCYTJnjUTXcn7lqy0io"; 

const keywordDB = ["ì±…ì„ê°", "ì†Œí†µ", "í˜‘ë ¥", "ì—´ì •", "ì„±ì‹¤", "ë¦¬ë”ì‹­", "ë°ì´í„°", "ë¶„ì„"];
const typoDB = { "ì•Šë˜ë‚˜ìš”": "ì•ˆ ë˜ë‚˜ìš”", "ë¬ë‹¤": "ëë‹¤", "ì—­í™œ": "ì—­í• ", "ì¼ì¼íˆ": "ì¼ì¼ì´" };
let currentTypos = {};

// ë©”ì¸ ë¶„ì„ í•¨ìˆ˜
function analyze() {
    const text = document.getElementById('essayInput').value;
    document.getElementById('withSpace').innerText = text.length.toLocaleString();
    document.getElementById('noSpace').innerText = text.replace(/\s/g, '').length.toLocaleString();
    document.getElementById('wordCount').innerText = text.trim() ? text.trim().split(/\s+/).length : 0;
    checkTypos(text);
}

// ì˜¤íƒ€ ê²€ì‚¬ í•¨ìˆ˜
function checkTypos(text) {
    const area = document.getElementById('typoAlertArea');
    const list = document.getElementById('typoList');
    currentTypos = {};
    let html = '';
    for (const [typo, correct] of Object.entries(typoDB)) {
        if (text.includes(typo)) {
            currentTypos[typo] = correct;
            html += `<li>'${typo}' â†’ '${correct}'</li>`;
        }
    }
    area.style.display = html ? 'block' : 'none';
    list.innerHTML = html;
}

// ì˜¤íƒ€ ìˆ˜ì • í•¨ìˆ˜
function fixAllTypos() {
    let text = document.getElementById('essayInput').value;
    for (const [typo, correct] of Object.entries(currentTypos)) {
        text = text.replace(new RegExp(typo, 'g'), correct);
    }
    document.getElementById('essayInput').value = text;
    analyze();
}

/**
 * [í•µì‹¬ ìˆ˜ì •] AI ì§€ëŠ¥í˜• êµì • í•¨ìˆ˜
 * ì£¼ì†Œë¥¼ v1betaë¡œ ë³€ê²½í•˜ê³  ëª¨ë“  ë¡œì§ì„ í•¨ìˆ˜ ì•ˆì— ë„£ì—ˆìŠµë‹ˆë‹¤.
 */
/**
 * AI ì§€ëŠ¥í˜• ë¬¸ì¥ êµì • í•¨ìˆ˜ (Gemini 2.0 Flash ì ìš© ë²„ì „)
 */
/**
 * [í•¨ìˆ˜ ì „ì²´ êµì²´] AI ì§€ëŠ¥í˜• ë¶„ì„ ë° êµì • ë¡œì§
 */
// index.html íŒŒì¼ ë‚´ ìˆ˜ì •ëœ í•¨ìˆ˜
async function callGeminiAPI() {
    const text = document.getElementById('essayInput').value;
    if (text.length < 10) return alert("ë¶„ì„ì„ ìœ„í•´ ë‚´ìš©ì„ ë” ì…ë ¥í•´ì£¼ì„¸ìš”.");

    const content = document.getElementById('aiContent');
    const area = document.getElementById('aiResultArea');
    const loading = document.getElementById('aiLoading');

    area.style.display = "block";
    loading.style.display = "inline";
    content.innerText = "ì „ë¬¸ ì„œë²„ì—ì„œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì•½ 10ì´ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...";

    try {
        /**
         * [í•µì‹¬] êµ¬ê¸€ API ì£¼ì†Œë¥¼ ì§ì ‘ ì ì§€ ì•ŠìŠµë‹ˆë‹¤.
         * ëŒ€ì‹  ìš°ë¦¬ê°€ ë§Œë“¤ /api/analyze ì£¼ì†Œë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
         */
        const resp = await fetch('/api/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: text }) // ì‚¬ìš©ìê°€ ì“´ ê¸€ì„ ì„œë²„ë¡œ ì „ë‹¬
        });

        const data = await resp.json();

        // ì„œë²„(api/analyze.js)ì—ì„œ ë³´ë‚´ì¤€ ë°ì´í„°ë¥¼ í™”ë©´ì— ì¶œë ¥í•©ë‹ˆë‹¤.
        if (data.candidates && data.candidates[0].content) {
            const resultText = data.candidates[0].content.parts[0].text;
            const scoreMatch = resultText.match(/\[\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\]/);
            
            if (scoreMatch) {
                updateDashboard(parseInt(scoreMatch[1]), parseInt(scoreMatch[2]), parseInt(scoreMatch[3]));
                const reportBody = resultText.replace(/\[.*?\]/, "").trim();
                content.innerHTML = formatReport(reportBody);
            } else {
                content.innerHTML = formatReport(resultText);
            }
        }
    } catch (e) {
        content.innerText = "ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Vercel ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
    } finally {
        loading.style.display = "none";
    }
}
// í¸ì˜ ê¸°ëŠ¥ë“¤
function copyToClipboard() {
    navigator.clipboard.writeText(document.getElementById('aiContent').innerText);
    alert("ë³µì‚¬ ì™„ë£Œ!");
}

function saveAsTxt() {
    const blob = new Blob([document.getElementById('aiContent').innerText], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ìì†Œì„œ_êµì •.txt';
    a.click();
}

function resetAll() {
    document.getElementById('essayInput').value = '';
    analyze();
}
</script>
</body>
</html>